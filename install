#!/bin/sh

clear

SALIR=0
OPCION=0
while [ $SALIR -eq 0 ]; do
echo -e "\e[1;40;32m####################################################################\e[0m"
echo -e "\e[1;40;32m#								   #\e[0m"
echo -e "\e[1;40;32m# SCRIPT PUBLICADO POR perraka DE MULTICS.ES Y MODIFICADO POR PIFO #\e[0m"
echo -e "\e[1;40;32m# FOROS AUTORIZADOS PARA PUBLICACION                               #\e[0m"
echo -e "\e[1;40;32m# MULTICSFORO.COM                                                  #\e[0m"
echo -e "\e[1;40;32m# MULTICS.EU                                                       #\e[0m"
echo -e "\e[1;40;32m# MULTICS.ES                                                       #\e[0m"
echo -e "\e[1;40;32m#								   #\e[0m"
echo -e "\e[1;40;32m#			ULTIMA EDICION 27-05-2021		   #\e[0m"
echo -e "\e[1;40;32m#								   #\e[0m"
echo -e "\e[1;40;32m####################################################################\e[0m"
echo -e "\e[38;5;75mMenu:\e[0m"

   echo -e "\e[1;40;37m1) \e[1;40;32mInstalar Firewall\e[0m"
   echo -e "\e[1;40;37m2) \e[1;40;31mEliminar Firewall\e[0m"
   echo -e "\e[1;40;37m3) \e[38;5;75mManual de Uso Para Ban/Unban\e[0m"
   echo -e "\e[1;40;376m4) \e[38;5;226mSalir\e[0m"
   echo -e "\e[38;5;75mOpcion seleccionada:\e[0m"
   read OPCION
   case $OPCION in
       1)
clear
mkdir /etc/myOwnFirewall > /dev/null 2>&1
wget https://pifo-emu.github.io/Firewall-multics/Firewall -O /etc/myOwnFirewall/myOwnFirewall > /dev/null 2>&1
chmod +x -R /etc/myOwnFirewall

echo -e "\e[1;40;35mNOMBRE DE VUESTRA TARJETA DE RED. E.j: eth0\e[0m" 
read red_
sed s/"red_"/"$red_"/g -i /etc/myOwnFirewall/myOwnFirewall 

echo -e "\e[1;40;35mPUERTOS QUE USA LA MULTICS EN LOS PROFILES. E.j: 8000:8010\e[0m"
read pro_
sed s/"pro_"/"$pro_"/g -i /etc/myOwnFirewall/myOwnFirewall 

echo -e "\e[1;40;35mPUERTO HTTP QUE USA LA MULTICS. E.j: 8888\e[0m"
read web_
sed s/"web_"/"$web_"/g -i /etc/myOwnFirewall/myOwnFirewall 

echo -e "\e[1;40;35mPUERTOS QUE USA LA MULTICS PARA CCCAM MGCAMD O CUALQUIER OTRO PROTOCOLO QUE USES. E.j: 4000,12001,18003,...\e[0m"
read pr2_
sed s/"pr2_"/"$pr2_"/g -i /etc/myOwnFirewall/myOwnFirewall 

echo -e "\e[1;40;35mPUERTOS QUE USA LA MULTICS PARA CACHE. E.j: 5000\e[0m"
read cac_
sed s/"cac_"/"$cac_"/g -i /etc/myOwnFirewall/myOwnFirewall 

echo -e "\e[1;40;35mPUERTO SSH\e[0m"
echo -e "\e[1;40;31m!!ATENCION!! NO TE EQUIVOQUES\e[0m"
read ss_
sed s/"ss_"/"$ss_"/g -i /etc/myOwnFirewall/myOwnFirewall 



ln -s /etc/myOwnFirewall/myOwnFirewall /usr/sbin/f > /dev/null 2>&1
ln -s /etc/myOwnFirewall/myOwnFirewall  /etc/init.d/myOwnFirewall > /dev/null 2>&1

touch /etc/myOwnFirewall/banList > /dev/null 2>&1

echo -e "\e[1;40;31m!!ATENCION!! AHORA REALIZAREMOS UN TEST TENDRAS 1 MINUTO PARA REALIZAR LAS PRUEBAS\e[0m"
echo -e "\e[1;40;31mPRUEBA QUE TENGAS ACCESO A LA MULTICS Y A SSH\e[0m"

/etc/myOwnFirewall/myOwnFirewall test

echo -e "\e[1;40;31m!!ATENCION!! TUVISTES ACCESO A SSH Y A LA MULTICS?\e[0m"
echo -e "\e[1;40;31mESCRIBE SI O NO, EN MINUSCULA\e[0m"
read "texto"
if [ "$texto" = "si" ]; then
systemctl enable myOwnFirewall > /dev/null 2>&1
/etc/myOwnFirewall/myOwnFirewall start
else

echo -e "\e[1;40;31mEDITA MANUAL EL ARCHIVO /etc/myOwnFirewall/myOwnFirewall\e[0m"
echo -e "\e[1;40;31mTE DARE 5 MINUTOS ANTES DE VOLVER A REALIZAR UN TEST\e[0m"
sleep 300
echo -e "\e[1;40;31m!!ATENCION!! VOLVEREMOS A REALIZAR UN TEST TENDRAS 1 MINUTO PARA REALIZAR LAS PRUEBAS\e[0m"
echo -e "\e[1;40;31mPRUEBA QUE TENGAS ACCESO A LA MULTICS Y A SSH\e[0m"
/usr/sbin/f test
echo -e "\e[1;40;31m!!ATENCION!! TUVISTES ACCESO A SSH Y A LA MULTICS?\e[0m"
echo -e "\e[1;40;31mESCRIBE SI O NO, EN MINUSCULA\e[0m"
read "texto"

if [ "$texto" = "si" ]; then
systemctl enable myOwnFirewall > /dev/null 2>&1
/etc/myOwnFirewall/myOwnFirewall start 
else

echo "VUELVE A INTENTARLO EN OTRO MOMENTO HOY NO ES TU DIA"
echo "AHORA ELIMINARE LO QUE YA SE HABIA DESCARGADO PARA QUE EMPIECES NUEVAMENTE "
rm -rf  /etc/myOwnFirewall /usr/sbin/f /etc/init.d/myOwnFirewall > /dev/null 2>&1

fi
fi
;;
       2)
clear
/etc/myOwnFirewall/myOwnFirewall stop  > /dev/null 2>&1
rm -rf  /etc/myOwnFirewall /usr/sbin/f /etc/init.d/myOwnFirewall > /dev/null 2>&1
           rm /tmp/install > /dev/null 2>&1

echo -e "\e[1;40;31mFirewall Eliminado\e[0m"

           SALIR=1 ;;

       3)
           clear
   echo -e "\e[1;40;32mBan IP: /etc/myOwnFirewall/myOwnFirewall ban \e[38;5;226m[IP]\e[0m"
   echo -e "\e[1;40;32mBan IP: /etc/myOwnFirewall/myOwnFirewall ban \e[38;5;226m[HOST]\e[0m"
   echo -e "\e[1;40;32mUnban IP: /etc/myOwnFirewall/myOwnFirewall unban \e[38;5;226m[IP]\e[0m"
   echo -e "\e[1;40;32mUnban IP: /etc/myOwnFirewall/myOwnFirewall unban \e[38;5;226m[HOST]\e[0m"
              rm /tmp/install > /dev/null 2>&1

           SALIR=1 ;;

       4)
           clear
           rm /tmp/install > /dev/null 2>&1
           SALIR=1 ;;
       *)
           clear
         echo "Opcion erronea";;
   esac
done
